<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="typora-root-url: images java面试java基础集合有哪些Collection  collection是集合的根接口，其下有两个继承子类List和Set集合 List集合 特点：有序，元素可重复     底层结构 特点 线程安全    ArrayList 数组 查找快，增删慢 不安全   LinkedList 双向循环链表 查找慢，增删快 不安全   Vector 数组 查">
<meta property="og:type" content="article">
<meta property="og:title" content="JAVA基础学习">
<meta property="og:url" content="https://github.com/hage1527/2019/11/16/JAVA基础学习/index.html">
<meta property="og:site_name" content="好好学习，天天向上！">
<meta property="og:description" content="typora-root-url: images java面试java基础集合有哪些Collection  collection是集合的根接口，其下有两个继承子类List和Set集合 List集合 特点：有序，元素可重复     底层结构 特点 线程安全    ArrayList 数组 查找快，增删慢 不安全   LinkedList 双向循环链表 查找慢，增删快 不安全   Vector 数组 查">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/hage1527/2019/11/16/JAVA基础学习/images/Collection.png">
<meta property="og:image" content="https://github.com/hage1527/2019/11/16/JAVA基础学习/images/Map-1573300870078.png">
<meta property="og:image" content="f:/我的坚果云/images/内存区域.jpg">
<meta property="og:image" content="f:/我的坚果云/images/标记-清除.jpg">
<meta property="og:image" content="f:/我的坚果云/images/复制.jpg">
<meta property="og:image" content="f:/我的坚果云/images/标记-整理.jpg">
<meta property="og:image" content="f:/我的坚果云/images/image-20191111141320109.png">
<meta property="og:image" content="https://github.com/hage1527/2019/11/16/JAVA基础学习/images/%E7%B1%BB%E5%8A%A0%E8%BD%BD.jpg">
<meta property="og:image" content="f:/我的坚果云/images/java内存模型.jpg">
<meta property="og:image" content="f:/我的坚果云/images/线程之间的通信.jpg">
<meta property="og:image" content="https://github.com/hage1527/2019/11/16/JAVA基础学习/images/image-20191110163554353-1573375177959.png">
<meta property="og:updated_time" content="2019-11-16T09:01:10.545Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JAVA基础学习">
<meta name="twitter:description" content="typora-root-url: images java面试java基础集合有哪些Collection  collection是集合的根接口，其下有两个继承子类List和Set集合 List集合 特点：有序，元素可重复     底层结构 特点 线程安全    ArrayList 数组 查找快，增删慢 不安全   LinkedList 双向循环链表 查找慢，增删快 不安全   Vector 数组 查">
<meta name="twitter:image" content="https://github.com/hage1527/2019/11/16/JAVA基础学习/images/Collection.png">
  <link rel="canonical" href="https://github.com/hage1527/2019/11/16/JAVA基础学习/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>JAVA基础学习 | 好好学习，天天向上！</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">好好学习，天天向上！</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">hage的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://github.com/hage1527/2019/11/16/JAVA基础学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hage">
      <meta itemprop="description" content="每天写一点">
      <meta itemprop="image" content="/images/hage.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="好好学习，天天向上！">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">JAVA基础学习

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-16 16:59:27 / 修改时间：17:01:10" itemprop="dateCreated datePublished" datetime="2019-11-16T16:59:27+08:00">2019-11-16</time>
            </span>
          
            

            
          

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>typora-root-url: images</p>
<h1 id="java面试"><a href="#java面试" class="headerlink" title="java面试"></a>java面试</h1><h2 id="java基础"><a href="#java基础" class="headerlink" title="java基础"></a>java基础</h2><h3 id="集合有哪些"><a href="#集合有哪些" class="headerlink" title="集合有哪些"></a>集合有哪些</h3><p>Collection</p>
<p><img src="images/Collection.png" alt="集合"></p>
<p><strong>collection是集合的根接口，其下有两个继承子类List和Set集合</strong></p>
<p>List集合</p>
<p>特点：有序，元素可重复</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="center">底层结构</th>
<th>特点</th>
<th>线程安全</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ArrayList</td>
<td align="center">数组</td>
<td>查找快，增删慢</td>
<td>不安全</td>
</tr>
<tr>
<td align="left">LinkedList</td>
<td align="center">双向循环链表</td>
<td>查找慢，增删快</td>
<td>不安全</td>
</tr>
<tr>
<td align="left">Vector</td>
<td align="center">数组</td>
<td>查找快，增删慢</td>
<td>安全</td>
</tr>
</tbody></table>
<p>Set集合</p>
<p>特点：无序，元素不可重复</p>
<p> <strong>Set的实现类都是基于Map来实现的</strong> </p>
<table>
<thead>
<tr>
<th></th>
<th>底层结构</th>
<th>特点</th>
<th>线程安全</th>
</tr>
</thead>
<tbody><tr>
<td>HashSet</td>
<td>哈希表</td>
<td>无序</td>
<td>不安全</td>
</tr>
<tr>
<td>TreeSet</td>
<td>二叉树</td>
<td>有序</td>
<td>不安全</td>
</tr>
</tbody></table>
<p>Map</p>
<p><img src="images/Map-1573300870078.png" alt="map"></p>
<table>
<thead>
<tr>
<th></th>
<th>底层结构</th>
<th>特点</th>
<th>线程安全</th>
</tr>
</thead>
<tbody><tr>
<td>HashMap</td>
<td>数组+链表+红黑树</td>
<td></td>
<td>不安全</td>
</tr>
<tr>
<td>TreeMap</td>
<td>红黑树</td>
<td>有序</td>
<td>不安全</td>
</tr>
<tr>
<td>Hashtable</td>
<td></td>
<td></td>
<td>安全</td>
</tr>
<tr>
<td>ConcurrentHashMap</td>
<td></td>
<td></td>
<td>线程安全</td>
</tr>
</tbody></table>
<h3 id="String-StringBuilder-StringBuffer的区别"><a href="#String-StringBuilder-StringBuffer的区别" class="headerlink" title="String,StringBuilder,StringBuffer的区别"></a>String,StringBuilder,StringBuffer的区别</h3><p>String</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// final修饰，不可以继承，不支持对字符串的修改</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** 底层用字符数组存储,final修饰不可变 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br></pre></td></tr></table></figure>

<p>StringBuilder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持对字符串的修改，非线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilder</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 无参构造，默认16个字符大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringBuilder <span class="title">append</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.append(str);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>StringBuffer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码同StringBuilder基本相同，只是在方法前加了synchronized关键字，保证了线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuffer</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractStringBuilder</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">CharSequence</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a string buffer with no characters in it and an</span></span><br><span class="line"><span class="comment">     * initial capacity of 16 characters.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现多态的方式？"><a href="#实现多态的方式？" class="headerlink" title="实现多态的方式？"></a>实现多态的方式？</h3><ol>
<li>接口实现</li>
<li>父类和子类间方法重写</li>
<li>同一个类中方法重载</li>
</ol>
<h3 id="重载（Overload）和重写（Override）的区别？"><a href="#重载（Overload）和重写（Override）的区别？" class="headerlink" title="重载（Overload）和重写（Override）的区别？"></a>重载（Overload）和重写（Override）的区别？</h3><p>​        方法的重载和重写都是实现多态的方式，区别在于前者实现的是编译时的多态性，而后者实现的是运行时的多态性。重载发生在一个类中，同名的方法如果有不同的参数列表（参数类型不同、参数个数不同或者二者都不同）则视为重载；重写发生在子类与父类之间，重写要求子类被重写方法与父类被重写方法有相同的参数列表，有兼容的返回类型，比父类被重写方法更好访问，不能比父类被重写方法声明更多的异常（里氏代换原则）。重载对返回类型没有特殊的要求，不能根据返回类型进行区分。</p>
<h3 id="深拷贝和浅拷贝的区别"><a href="#深拷贝和浅拷贝的区别" class="headerlink" title="深拷贝和浅拷贝的区别"></a>深拷贝和浅拷贝的区别</h3><p>  <a href="https://www.cnblogs.com/shakinghead/p/7651502.html" target="_blank" rel="noopener">深拷贝和浅拷贝解析</a></p>
<ul>
<li><p>深拷贝对于引用数据类型的成员变量的对象图中涉及的对象都申请了内存空间</p>
<p>​    深拷贝的两种实现方式：</p>
<ol>
<li><p>重写Clone方法，只需要为对象图的每一层的每一个对象都实现Cloneable接口并重写clone方法，最后在最顶层的类的重写的Clone方法中调用所有的clone方法即可</p>
</li>
<li><p>序列化实现深拷贝</p>
</li>
</ol>
</li>
<li><p>浅拷贝只是复制了对象的引用，新的对象并没有对引用数据类型创建内存空间</p>
<p>​    浅拷贝的两种实现方式：</p>
<ol>
<li>拷贝构造函数</li>
<li>实现Cloneable接口重写clone方法</li>
</ol>
</li>
</ul>
<h3 id="NIO和BIO"><a href="#NIO和BIO" class="headerlink" title="NIO和BIO"></a>NIO和BIO</h3><h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><p>定义：在运行时java程序获取自身的属性，并且可以操作一些类和对象的属性</p>
<p><a href="https://www.sczyh30.com/posts/Java/java-reflection-1/#%E4%B8%80%E3%80%81%E5%9B%9E%E9%A1%BE%EF%BC%9A%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84%EF%BC%9F" target="_blank" rel="noopener">什么是反射</a></p>
<p>创建反射的三种方式</p>
<ol>
<li><p>Class.forName()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Returns the &#123;<span class="doctag">@code</span> Class&#125; object associated with the class or</span></span><br><span class="line"><span class="comment">* interface with the given string name. </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@CallerSensitive</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className)</span><br><span class="line">    <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">    <span class="keyword">return</span> forName0(className, <span class="keyword">true</span>, ClassLoader.getClassLoader(caller), caller);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//例，如加载mysql驱动类</span></span><br><span class="line">Class.forName(<span class="string">"com.mysql.jdbc.driver"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>类.Class</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; klass = <span class="keyword">int</span>.class;</span><br><span class="line">Class&lt;?&gt; classInt = Integer.TYPE;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对象.getClass()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// getClass()是Object类的本地方法，用c++实现的</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">registerNatives</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">      registerNatives();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 返回当前运行对象的所属类</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> Class&lt;?&gt; getClass();</span><br><span class="line"><span class="comment">//例</span></span><br><span class="line">StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">"123"</span>);</span><br><span class="line">Class&lt;?&gt; sbClass = sb.getClass();</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>反射创建实例</p>
<p><code>其实两种方法都是同一种方法，通过类对象创建实例是先获取无参构造对象，然后通过构造参数对象的newInstance获取实例，是一种特例</code></p>
<ol>
<li>通过类对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** newInstance()</span></span><br><span class="line"><span class="comment">     * 通过该类的空参构造函数构造该类的实例对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 寻找空参构造函数</span></span><br><span class="line">        <span class="keyword">if</span> (cachedConstructor == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span> == Class.class) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalAccessException(</span><br><span class="line">                    <span class="string">"Can not call newInstance() on the Class for java.lang.Class"</span></span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Class&lt;?&gt;[] empty = &#123;&#125;;</span><br><span class="line">                <span class="keyword">final</span> Constructor&lt;T&gt; c = getConstructor0(empty, Member.DECLARED);</span><br><span class="line">                </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 通过默认构造函数创建类的实例对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> tmpConstructor.newInstance((Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            Unsafe.getUnsafe().throwException(e.getTargetException());</span><br><span class="line">            <span class="comment">// Not reached</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">   <span class="comment">// 例</span></span><br><span class="line">   Class&lt;?&gt; str = String.Class;</span><br><span class="line">   String s = str.newInstance();</span><br></pre></td></tr></table></figure>

<p>2.通过构造方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Class类的方法</span></span><br><span class="line"><span class="comment">     * 通过可变构造参数类型获取该Class类的相应的构造函数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Constructor&lt;T&gt; <span class="title">getDeclaredConstructor</span><span class="params">(Class&lt;?&gt;... parameterTypes)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> NoSuchMethodException, SecurityException </span>&#123;</span><br><span class="line">        checkMemberAccess(Member.DECLARED, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> getConstructor0(parameterTypes, Member.DECLARED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Constructor类的方法</span></span><br><span class="line"><span class="comment">     * 运用指定的参数创建并初始化该构造函数的新实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">newInstance</span><span class="params">(Object ... initargs)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InstantiationException, IllegalAccessException,</span></span><br><span class="line"><span class="function">               IllegalArgumentException, InvocationTargetException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!override) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">                Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">                checkAccess(caller, clazz, <span class="keyword">null</span>, modifiers);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((clazz.getModifiers() &amp; Modifier.ENUM) != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Cannot reflectively create enum objects"</span>);</span><br><span class="line">        ConstructorAccessor ca = constructorAccessor;   <span class="comment">// read volatile</span></span><br><span class="line">        <span class="keyword">if</span> (ca == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ca = acquireConstructorAccessor();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        T inst = (T) ca.newInstance(initargs);</span><br><span class="line">        <span class="keyword">return</span> inst;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//例</span></span><br><span class="line"><span class="comment">//获取String所对应的Class对象</span></span><br><span class="line">Class&lt;?&gt; c = String.class;</span><br><span class="line"><span class="comment">//获取String类带一个String参数的构造器</span></span><br><span class="line">Constructor constructor = c.getConstructor(String.class);</span><br><span class="line"><span class="comment">//根据构造器创建实例</span></span><br><span class="line">Object obj = constructor.newInstance(<span class="string">"23333"</span>);</span><br></pre></td></tr></table></figure>

<p>反射获取方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Class类的方法</span></span><br><span class="line"><span class="comment">     * Returns an array containing &#123;<span class="doctag">@code</span> Method&#125; objects reflecting all the</span></span><br><span class="line"><span class="comment">     * public methods of the class or interface represented by this &#123;<span class="doctag">@code</span></span></span><br><span class="line"><span class="comment">     * Class&#125; object, including those declared by the class or interface and</span></span><br><span class="line"><span class="comment">     * those inherited from superclasses and superinterfaces.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="keyword">public</span> Method[] getMethods() <span class="keyword">throws</span> SecurityException &#123;</span><br><span class="line">        checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> copyMethods(privateGetPublicMethods());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/** Method类的方法：</span></span><br><span class="line"><span class="comment">     * Invokes the underlying method represented by this &#123;<span class="doctag">@code</span> Method&#125;</span></span><br><span class="line"><span class="comment">     * object, on the specified object with the specified parameters.</span></span><br><span class="line"><span class="comment">     * Individual parameters are automatically unwrapped to match</span></span><br><span class="line"><span class="comment">     * primitive formal parameters, and both primitive and reference</span></span><br><span class="line"><span class="comment">     * parameters are subject to method invocation conversions as</span></span><br><span class="line"><span class="comment">     * necessary.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object obj, Object... args)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IllegalAccessException, IllegalArgumentException,</span></span><br><span class="line"><span class="function">           InvocationTargetException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!override) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;</span><br><span class="line">                Class&lt;?&gt; caller = Reflection.getCallerClass();</span><br><span class="line">                checkAccess(caller, clazz, obj, modifiers);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        MethodAccessor ma = methodAccessor;             <span class="comment">// read volatile</span></span><br><span class="line">        <span class="keyword">if</span> (ma == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ma = acquireMethodAccessor();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ma.invoke(obj, args);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//例</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException </span>&#123;</span><br><span class="line">        Class&lt;?&gt; klass = methodClass.class;</span><br><span class="line">        <span class="comment">//创建methodClass的实例</span></span><br><span class="line">        Object obj = klass.newInstance();</span><br><span class="line">        <span class="comment">//获取methodClass类的add方法</span></span><br><span class="line">        Method method = klass.getMethod(<span class="string">"add"</span>,<span class="keyword">int</span>.class,<span class="keyword">int</span>.class);</span><br><span class="line">        <span class="comment">//调用method对应的方法 =&gt; add(1,4)</span></span><br><span class="line">        Object result = method.invoke(obj,<span class="number">1</span>,<span class="number">4</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">methodClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> fuck = <span class="number">3</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反射获取类的实例对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Class方法</span></span><br><span class="line"><span class="comment">     * 获取该Class类指定参数的属性对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@CallerSensitive</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Field <span class="title">getField</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> NoSuchFieldException, SecurityException </span>&#123;</span><br><span class="line">        checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), <span class="keyword">true</span>);</span><br><span class="line">        Field field = getField0(name);</span><br><span class="line">        <span class="keyword">if</span> (field == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchFieldException(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> field;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// Field类的方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object obj)</span></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">set</span><span class="params">(Object obj)</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>反射获取类的注解信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="keyword">public</span> &lt;A extends Annotation&gt; <span class="function">A <span class="title">getAnnotation</span><span class="params">(Class&lt;A&gt; annotationClass)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(annotationClass);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (A) annotationData().annotations.get(annotationClass);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>可以看做是代码上的标签</p>
<p>用<code>@interface</code>关键字来定义，注解在注解上的注解叫做元注解比如@Document、@Retention、@Target</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span> <span class="comment">//能够将注解的元素添加到javadoc文档中</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)<span class="comment">//注解保留策略</span></span><br><span class="line"><span class="comment">/* RetentionPolicy.SOUREC:只在源码阶段保留，在编译器编译时它将被丢弃忽视</span></span><br><span class="line"><span class="comment"> * RetentionPolicy.CLASS: 只保留到编译运行时，不会加载到jvm中</span></span><br><span class="line"><span class="comment"> * RetentionPolicy.RUNTIME:保留到程序运行时，被加载到jvm中，程序运行时可以获取到</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD&#125;)<span class="comment">//注解应用的对象</span></span><br><span class="line"><span class="comment">/* ElementType.ANNOTATION_TPYE:可以给一个注解进行注解</span></span><br><span class="line"><span class="comment"> * ElementType.CONSTRUCTOR:构造方法加注解</span></span><br><span class="line"><span class="comment"> * ElementType.FIELD:可以给属性进行注解</span></span><br><span class="line"><span class="comment"> * ElementType.LOCAL_VARIABLE:局部变量加注解</span></span><br><span class="line"><span class="comment"> * ElementType.METHOD:方法加注解</span></span><br><span class="line"><span class="comment"> * ElementType.PACKAGE:包加注解</span></span><br><span class="line"><span class="comment"> * ElementType.PARAMETER:方法内的参数加注解</span></span><br><span class="line"><span class="comment"> * ElementType.TPYE:可以给一个类型进行注解、比如类、接口、枚举</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Select &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注解的使用：<code>定义注解》使用注解》解析注解</code></p>
<p>1.定义注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: 自定义方法注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention</span>(value = RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(value = ElementType.METHOD)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MethodAnnotation &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> "这是一个方法注解"</span>; <span class="comment">//可以设置默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.使用注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: 使用注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationUser</span> </span>&#123;</span><br><span class="line">    <span class="meta">@MethodAnnotation</span>(value = <span class="string">"method方法注解"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method 方法执行"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.解释注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description: 解释注解</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException </span>&#123;</span><br><span class="line">        <span class="comment">// 实例化类</span></span><br><span class="line">        AnnotationUser user = <span class="keyword">new</span> AnnotationUser();</span><br><span class="line">        <span class="comment">// 通过反射获取类信息</span></span><br><span class="line">        Class&lt;? extends AnnotationUser&gt; userClass = user.getClass();</span><br><span class="line">        <span class="comment">// 类获取method方法</span></span><br><span class="line">        Method method = userClass.getMethod(<span class="string">"method"</span>);</span><br><span class="line">        <span class="comment">// 获取method方法上的注解信息</span></span><br><span class="line">        MethodAnnotation annotation = method.getAnnotation(MethodAnnotation.class);</span><br><span class="line">        <span class="comment">// 通过注解信息执行操作</span></span><br><span class="line">        System.out.println(annotation.value());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><h3 id="内存区域"><a href="#内存区域" class="headerlink" title="内存区域"></a>内存区域</h3><img src="F:/我的坚果云/images/内存区域.jpg" alt="内存区域">

<p><strong>方法区和堆是线程共享的区域</strong></p>
<p><strong>本地方法栈、虚拟机栈、程序计数器线程私有</strong></p>
<ol>
<li><p>程序计数器</p>
<ul>
<li><p>如果是java方法，记录正在执行的虚拟机字节码指令的地址</p>
</li>
<li><p>如果是native方法，地址为空</p>
</li>
</ul>
</li>
<li><p>本地方法栈</p>
<p>native 方法栈</p>
</li>
<li><p>虚拟机栈</p>
<ul>
<li>每个方法在执行的同时会创建一个栈帧，每个方法执行的过程，就对应着一个栈帧从入栈到出栈的过程</li>
<li><strong>栈需要连续的内存空间</strong></li>
<li>不需要GC，因为方法执行完，栈帧就消失了</li>
</ul>
</li>
<li><p>java堆</p>
<p><strong>唯一目的：存放对象实例</strong></p>
<ul>
<li>垃圾收集器管理的主要区域，也称为GC堆</li>
<li>java堆可以处于物理上不连续的内存空间，只要逻辑上连续即可</li>
</ul>
</li>
<li><p>方法区</p>
<p><strong>个人理解它用来存储那些可以被线程共享以及不变的部分</strong></p>
<p>存储已被虚拟机加载的类信息、常量、静态变量、编译后的代码等</p>
<ul>
<li>这部分的内存回收主要是针对常量和类型的回收</li>
<li>还包括运行时常量池，运行时常量池是将Class文件常量池的符号引用变为直接引用</li>
</ul>
</li>
</ol>
<h3 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h3><h4 id="对象存活性判断"><a href="#对象存活性判断" class="headerlink" title="对象存活性判断"></a>对象存活性判断</h4><ol>
<li><p>引用计数器</p>
<p>给对象添加一个引用计数器，每当一个地方引用它时，计数器加一，当引用失效时，计数器减一</p>
<p>缺点：<u>很难解决对象之间的循环引用问题</u></p>
</li>
<li><p>对象可达性分析</p>
<p><strong>目前，JAVA采用这种方式来判断对象是否存活</strong></p>
<p>基本思想：通过一系列的”GC ROOTS”作为根节点，从这些根节点往下搜索，经过的路径称为引用链，当一个对象到GC ROOTS没有引用链时，证明此对象不可用</p>
<p>可以作为GC Roots的对象：</p>
<ul>
<li>虚拟机栈（栈帧中的局部变量表）中引用的对象</li>
<li>方法区中类静态属性引用的对象</li>
<li>方法区中常量引用的对象</li>
<li>native方法栈引用的对象</li>
</ul>
</li>
</ol>
<h4 id="无用的类"><a href="#无用的类" class="headerlink" title="无用的类"></a>无用的类</h4><ul>
<li>类的实例对象已经被回收</li>
<li>加载该类的ClassLoader已经被回收</li>
<li>该类的Class对象没有在任何地方被引用，也无法通过反射访问该类的方法</li>
</ul>
<h4 id="垃圾收集算法"><a href="#垃圾收集算法" class="headerlink" title="垃圾收集算法"></a>垃圾收集算法</h4><ol>
<li><p>标记-清除</p>
<img src="F:/我的坚果云/images/标记-清除.jpg" alt="标记-清除" style="zoom:50%;">
</li>
<li><p>标记-复制</p>
<img src="F:/我的坚果云/images/复制.jpg" alt="标记-复制" style="zoom: 50%;">
</li>
<li><p>标记-整理</p>
<img src="F:/我的坚果云/images/标记-整理.jpg" alt="标记-整理" style="zoom:80%;">
</li>
<li><p>分代收集</p>
<p>把java堆分为新生代和老生代。根据各个年代的特点采用不同的收集策略</p>
<ul>
<li>新生代死的多、活的少。采用复制算法</li>
<li>老生代存活率高，采用标记-清理或标记-整理</li>
</ul>
</li>
</ol>
<h4 id="HotSpot算法实现"><a href="#HotSpot算法实现" class="headerlink" title="HotSpot算法实现"></a>HotSpot算法实现</h4><img src="F:/我的坚果云/images/image-20191111141320109.png" alt="image-20191111141320109" style="zoom: 67%;">

<h3 id="java当中的四种引用"><a href="#java当中的四种引用" class="headerlink" title="java当中的四种引用"></a>java当中的四种引用</h3><p>强软弱虚</p>
<ul>
<li><p>强引用： Object obj = new Object</p>
</li>
<li><p>软引用：  对于软引用关联着的对象，在系统将要发生内存溢出异常之前，列入回收范围进行二次回收</p>
<p><strong>如果内存空间足够，垃圾回收器就不会回收它，如果内存空间不足了，就会回收这些对象的内存</strong> . 软引用可用来实现内存敏感的高速缓存 </p>
</li>
<li><p>弱引用： 弱引用关联的对象只能生存到下一次垃圾收集发生之前</p>
<p><strong>弱引用与软引用的区别在于：只具有弱引用的对象拥有更短暂的生命周期</strong>。在<strong>垃圾回收器线程扫描它所管辖的内存区域的过程中，一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存</strong> </p>
</li>
<li><p>虚引用： 能在这个对象被收集器回收时收到一个系统通知 ,<strong>在任何时候都可能被垃圾回收</strong> </p>
</li>
</ul>
<h3 id="类加载机制"><a href="#类加载机制" class="headerlink" title="类加载机制"></a>类加载机制</h3><h4 id="类加载的时机："><a href="#类加载的时机：" class="headerlink" title="类加载的时机："></a>类加载的时机：</h4><ol>
<li>new实例化对象、访问类的静态字段、调用类的静态方法</li>
<li>反射</li>
<li>初始化类时，若发现父类没有初始化，则初始化父类</li>
<li>虚拟机启动时，需要一个主类</li>
</ol>
<h4 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h4><p><img src="images/%E7%B1%BB%E5%8A%A0%E8%BD%BD.jpg" alt="类加载器"></p>
<ul>
<li>Bootstrap ClassLoader</li>
</ul>
<p>​    由C++写的,由JVM启动.</p>
<p>​    启动类加载器,负责加载java基础类，对应的文件是%JRE_HOME/lib/ 目录下的rt.jar、resources.jar、   charsets.jar和class等</p>
<ul>
<li><p>Extension ClassLoader</p>
<p>Java类,继承自URLClassLoader 扩展类加载器,</p>
</li>
</ul>
<p>​    对应的文件是 %JRE_HOME/lib/ext 目录下的jar和class等</p>
<ul>
<li><p>App ClassLoader</p>
<p>Java类,继承自URLClassLoader 系统类加载器,</p>
<p>对应的文件是应用程序classpath目录下的所有jar和class等</p>
</li>
</ul>
<h4 id="自定义类加载器"><a href="#自定义类加载器" class="headerlink" title="自定义类加载器"></a>自定义类加载器</h4><ol>
<li><p>继承ClassLoader类，重写findClass方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClassLoader</span> <span class="keyword">extends</span> <span class="title">ClassLoader</span> </span>&#123;</span><br><span class="line">    <span class="comment">//指定路径</span></span><br><span class="line">    <span class="keyword">private</span> String path ;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyClassLoader</span><span class="params">(String classPath)</span></span>&#123;</span><br><span class="line">        path=classPath;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写findClass方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 是我们这个类的全路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class log = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 获取该class文件字节码数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] classData = getData();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (classData != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 将class的字节码数组转换成Class类的实例</span></span><br><span class="line">            log = defineClass(name, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> log;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将class文件转化为字节码数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">byte</span>[] getData() &#123;</span><br><span class="line"> </span><br><span class="line">        File file = <span class="keyword">new</span> File(path);</span><br><span class="line">        <span class="keyword">if</span> (file.exists())&#123;</span><br><span class="line">            FileInputStream in = <span class="keyword">null</span>;</span><br><span class="line">            ByteArrayOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                in = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">                out = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">                <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> ((size = in.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    out.write(buffer, <span class="number">0</span>, size);</span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"> </span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> out.toByteArray();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><h4 id="类加载的过程："><a href="#类加载的过程：" class="headerlink" title="类加载的过程："></a>类加载的过程：</h4></li>
</ol>
<p><strong>加载》验证》准备》解析》初始化</strong></p>
<ol>
<li><p>加载 </p>
<ul>
<li>通过类的全限定名找到类的字节码文件</li>
<li>把类的字节码文件放到方法区内</li>
<li>在方法区内生成一个这个类的Class对象</li>
</ul>
</li>
<li><p>验证</p>
<p>确保Class文件中的字节码符合虚拟机要求，且不会危害虚拟机安全</p>
<ul>
<li>文件格式验证</li>
<li>元数据验证</li>
<li>字节码验证</li>
<li>符号引用验证</li>
</ul>
</li>
<li><p>准备</p>
<p>给类的静态变量（存储在方法区中)赋值，注意赋的是类型的默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例</span></span><br><span class="line">pulic <span class="keyword">static</span> <span class="keyword">int</span> value = <span class="number">123</span>；</span><br><span class="line">经过准备阶段后value值为<span class="number">0</span>，而不是<span class="number">123</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>解析</p>
<p>将常量池的符号引用替换为直接应用</p>
</li>
<li><p>初始化</p>
<p>给所有的类变量（静态变量）赋值和执行静态代码块</p>
</li>
</ol>
<h3 id="虚拟机性能监控工具"><a href="#虚拟机性能监控工具" class="headerlink" title="虚拟机性能监控工具"></a>虚拟机性能监控工具</h3><h4 id="jps-虚拟机进程状况工具"><a href="#jps-虚拟机进程状况工具" class="headerlink" title="jps:虚拟机进程状况工具"></a>jps:虚拟机进程状况工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> jps 只查询运行的进程和进程名</span></span><br><span class="line">[hage@hadoop100 ~]$ jps</span><br><span class="line">4432 Jps</span><br><span class="line">2882 NameNode</span><br><span class="line">3395 JobHistoryServer</span><br><span class="line">3306 NodeManager</span><br><span class="line">3003 DataNode</span><br><span class="line">2703 QuorumPeerMain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jps -l 输出主类的全名</span></span><br><span class="line">[hage@hadoop100 ~]$ jps -l</span><br><span class="line">2882 org.apache.hadoop.hdfs.server.namenode.NameNode</span><br><span class="line">3395 org.apache.hadoop.mapreduce.v2.hs.JobHistoryServer</span><br><span class="line">4564 sun.tools.jps.Jps</span><br><span class="line">3306 org.apache.hadoop.yarn.server.nodemanager.NodeManager</span><br><span class="line">3003 org.apache.hadoop.hdfs.server.datanode.DataNode</span><br><span class="line">2703 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jps -m 输出传递给main函数的参数</span></span><br><span class="line">[hage@hadoop100 ~]$ jps -m </span><br><span class="line">2882 NameNode</span><br><span class="line">3395 JobHistoryServer</span><br><span class="line">3306 NodeManager</span><br><span class="line">3003 DataNode</span><br><span class="line">4589 Jps -m</span><br><span class="line">2703 QuorumPeerMain /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jps -v 输出进程启动时jvm参数</span></span><br><span class="line">[hage@hadoop100 ~]$ jps -v</span><br><span class="line">2882 NameNode -Dproc_namenode -Xmx1000m -Djava.net.preferIPv4Stack=true -Dhadoop.log.dir=/opt/module/hadoop-2.7.2/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/opt/module/hadoop-2.7.2 -Dhadoop.id.str=hage -Dhadoop.root.logger=INFO,console -Djava.library.path=/opt/module/hadoop-2.7.2/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Djava.net.preferIPv4Stack=true -Djava.net.preferIPv4Stack=true -Dhadoop.log.dir=/opt/module/hadoop-2.7.2/logs -Dhadoop.log.file=hadoop-hage-namenode-hadoop100.log -Dhadoop.home.dir=/opt/module/hadoop-2.7.2 -Dhadoop.id.str=hage -Dhadoop.root.logger=INFO,RFA -Djava.library.path=/opt/module/hadoop-2.7.2/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Dhadoop.security.logger=INFO,RFAS -Dhdfs.audit.logger=INFO,NullAppender -Dhadoop.security.logger=INFO,RFAS -Dhdfs.audit.logger=INFO,NullAppender -Dhadoop.security.logger=INFO,RFAS -Dhdfs.audit.logger=INFO,NullAppender -Dhadoop.security.logger=INFO,RFAS</span><br><span class="line">3395 JobHistoryServer -Dproc_historyserver -Xmx1000m -Djava.net.preferIPv4Stack=true -Dhadoop.log.dir=/opt/module/hadoop-2.7.2/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/opt/module/hadoop-2.7.2 -Dhadoop.id.str=hage -Dhadoop.root.logger=INFO,console -Djava.library.path=/opt/module/hadoop-2.7.2/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Dhadoop.log.dir=/opt/module/hadoop-2.7.2/logs -Dhadoop.log.file=hadoop.log -Dhadoop.root.logger=INFO,console -Dhadoop.id.str=hage -Djava.net.preferIPv4Stack=true -Dhadoop.log.dir=/opt/module/hadoop-2.7.2/logs -Dhadoop.log.file=hadoop.log -Dhadoop.home.dir=/opt/module/hadoop-2.7.2 -Dhadoop.id.str=hage -Dhadoop.root.logger=INFO,console -Djava.library.path=/opt/module/hadoop-2.7.2/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Dhadoop.log.dir=/opt/module/hadoop-2.7.2/logs -Dhadoop.log.file=mapred-hage-historyserver-hadoop100.log -Dhadoop.root.logger=INFO,RFA -Dmapred.jobsummary.logger=INFO,JSA -Dhadoop.security.logger=</span><br></pre></td></tr></table></figure>

<h4 id="jstat-虚拟机统计信息监视工具"><a href="#jstat-虚拟机统计信息监视工具" class="headerlink" title="jstat:虚拟机统计信息监视工具"></a>jstat:虚拟机统计信息监视工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[hage@hadoop100 ~]$ jstat -options</span><br><span class="line">-class  #监视类装载及卸载的数量大小时间</span><br><span class="line">-compiler # 输出JIT编译器编译过的方法耗时等信息</span><br><span class="line">-gc # 监视java堆状况</span><br><span class="line">-gccapacity # 与-gc基本相同，主要关注java堆各个区域的最大最小空间</span><br><span class="line">-gccause # 与-gcutil类似，额外输出导致上一次GC产生的原因</span><br><span class="line">-gcmetacapacity # 主要关注java元数据区的最大最小空间</span><br><span class="line">-gcnew # 监视新生代gc状况</span><br><span class="line">-gcnewcapacity # 主要关注新生代使用的最大最小空间</span><br><span class="line">-gcold # 监视老生代gc状况</span><br><span class="line">-gcoldcapacity # 主要关注老生代使用的最大最小空间</span><br><span class="line">-gcutil # 主要关注java堆已使用空间的占比</span><br><span class="line">-printcompilation # 输出已经被JTL编译的方法</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jstat -class pid 监视类装载及卸载的数量大小时间</span></span><br><span class="line"> [hage@hadoop100 ~]$ jstat -class 2882</span><br><span class="line"> Loaded  Bytes  Unloaded  Bytes     Time   </span><br><span class="line">   5382 11511.8       14    18.3      10.48</span><br><span class="line"><span class="meta">#</span><span class="bash">类装载数量 大小   未装载类    大小       时间</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jstat -printcompilation pid 输出已经被JIT编译的方法</span></span><br><span class="line">[hage@hadoop100 ~]$ jstat -printcompilation 2882</span><br><span class="line">Compiled  Size  Type Method</span><br><span class="line">    4584     73    1 org/apache/hadoop/hdfs/protocol/proto/ClientNamenodeProtocolProtos$GetListingResponseProto isInitialized</span><br><span class="line"><span class="meta">#</span><span class="bash"> jstat -gc pid 监视java堆的状况</span></span><br><span class="line">[hage@hadoop100 ~]$ jstat -gc 2882</span><br><span class="line"> S0C S1C  S0U  S1U  EC  EU  OC  OU   MC  MU  CCSC  CCSU  YGC   YGCT   FGC  FGCT   GCT   </span><br><span class="line">1984.0 1984.0  16.4   0.0   16256.0  13051.3   40292.0    25164.8   36184.0 35486.8 4096.0 3957.2     30    0.327   2      0.165    0.492</span><br><span class="line"><span class="meta">#</span><span class="bash"> s0c:suriver0 capacity s1c:suriver1 capacity EC:Eden capacity ... MC:Meta capacity</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> s0U:suriver0 use s1c:suriver1 use EC:Eden use ... MC:Meta use</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> YGC:Young Gc Count YGCT:Young GC Time...</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CCS:压缩类空间大小 CCSU:压缩类空间使用大小</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jstat -gccapacity pid 输出主要关注最大、最小空间</span></span><br><span class="line">[hage@hadoop100 ~]$ jstat -gccapacity 2882</span><br><span class="line"> NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC </span><br><span class="line"> 17728.0 341312.0  20224.0 1984.0 1984.0  16256.0    35520.0   682688.0    40292.0    40292.0      0.0 1081344.0  36440.0      0.0 1048576.0   4096.0     32     2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> jstat -gcutil pid 输出java堆信息，主要关注百分比</span></span><br><span class="line">[hage@hadoop100 ~]$ jstat -gcutil 2882</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT   </span><br><span class="line">  0.00   0.00  87.49  60.00  98.27  95.00     28    0.308     2    0.165    0.473</span><br></pre></td></tr></table></figure>

<h4 id="jinfo-Java配置信息工具"><a href="#jinfo-Java配置信息工具" class="headerlink" title="jinfo:Java配置信息工具"></a>jinfo:Java配置信息工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[hage@hadoop100 ~]$ jinfo -options</span><br><span class="line">Usage:</span><br><span class="line">    jinfo [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jinfo [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jinfo [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br><span class="line"></span><br><span class="line">where &lt;option&gt; is one of:</span><br><span class="line">    -flag &lt;name&gt;         to print the value of the named VM flag</span><br><span class="line">    -flag [+|-]&lt;name&gt;    to enable or disable the named VM flag</span><br><span class="line">    -flag &lt;name&gt;=&lt;value&gt; to set the named VM flag to the given value</span><br><span class="line">    -flags               to print VM flags</span><br><span class="line">    -sysprops            to print Java system properties</span><br><span class="line">    &lt;no option&gt;          to print both of the above</span><br><span class="line">    -h | -help           to print this help message</span><br></pre></td></tr></table></figure>

<h4 id="jmap-java内存映像工具"><a href="#jmap-java内存映像工具" class="headerlink" title="jmap: java内存映像工具"></a>jmap: java内存映像工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[hage@hadoop100 ~]$ jmap -option</span><br><span class="line">Usage:</span><br><span class="line">    jmap [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jmap [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br><span class="line"></span><br><span class="line">where &lt;option&gt; is one of:</span><br><span class="line">    &lt;none&gt;               to print same info as Solaris pmap</span><br><span class="line">    -heap                打印java堆的汇总信息</span><br><span class="line">    -histo[:live]        to print histogram of java object heap; if the "live"</span><br><span class="line">                         suboption is specified, only count live objects</span><br><span class="line">    -clstats             打印classloader静态信息</span><br><span class="line">    -finalizerinfo       打印等待执行finalize方法对象的信息</span><br><span class="line">    -dump:&lt;dump-options&gt; # 生成堆转存快照</span><br><span class="line">                         to dump java heap in hprof binary format</span><br><span class="line">                         dump-options:</span><br><span class="line">                           live         dump only live objects; if not specified,</span><br><span class="line">                                        all objects in the heap are dumped.</span><br><span class="line">                           format=b     binary format</span><br><span class="line">                           file=&lt;file&gt;  dump heap to &lt;file&gt;</span><br><span class="line">                         Example: jmap -dump:live,format=b,file=heap.bin &lt;pid&gt;</span><br><span class="line">    -F                   force. Use with -dump:&lt;dump-options&gt; &lt;pid&gt; or -histo</span><br><span class="line">                         to force a heap dump or histogram when &lt;pid&gt; does not</span><br><span class="line">                         respond. The "live" suboption is not supported</span><br><span class="line">                         in this mode.</span><br><span class="line">    -h | -help           to print this help message</span><br><span class="line">    -J&lt;flag&gt;             to pass &lt;flag&gt; directly to the runtime system</span><br></pre></td></tr></table></figure>

<p>具体的使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">[hage@hadoop100 ~]$ jmap -finalizerinfo 2882</span><br><span class="line">Attaching to process ID 2882, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.162-b12</span><br><span class="line">Number of objects pending for finalization: 0</span><br><span class="line"></span><br><span class="line">[hage@hadoop100 ~]$ jmap -heap 2882</span><br><span class="line">Attaching to process ID 2882, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.162-b12</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Mark Sweep Compact GC</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 40</span><br><span class="line">   MaxHeapFreeRatio         = 70</span><br><span class="line">   MaxHeapSize              = 1048576000 (1000.0MB)</span><br><span class="line">   NewSize                  = 18153472 (17.3125MB)</span><br><span class="line">   MaxNewSize               = 349503488 (333.3125MB)</span><br><span class="line">   OldSize                  = 36372480 (34.6875MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 21807104 (20.796875MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 17592186044415 MB</span><br><span class="line">   G1HeapRegionSize         = 0 (0.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage: #堆使用情况</span><br><span class="line">New Generation (Eden + 1 Survivor Space):</span><br><span class="line">   capacity = 18677760 (17.8125MB)</span><br><span class="line">   used     = 8167888 (7.7895050048828125MB)</span><br><span class="line">   free     = 10509872 (10.022994995117188MB)</span><br><span class="line">   43.73055441337719% used</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = 16646144 (15.875MB)</span><br><span class="line">   used     = 8126832 (7.7503509521484375MB)</span><br><span class="line">   free     = 8519312 (8.124649047851562MB)</span><br><span class="line">   48.821108359990156% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = 2031616 (1.9375MB)</span><br><span class="line">   used     = 41056 (0.039154052734375MB)</span><br><span class="line">   free     = 1990560 (1.898345947265625MB)</span><br><span class="line">   2.0208543346774195% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = 2031616 (1.9375MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 2031616 (1.9375MB)</span><br><span class="line">   0.0% used</span><br><span class="line">tenured generation:</span><br><span class="line">   capacity = 41259008 (39.34765625MB)</span><br><span class="line">   used     = 27923680 (26.630096435546875MB)</span><br><span class="line">   free     = 13335328 (12.717559814453125MB)</span><br><span class="line">   67.67899024620272% used</span><br><span class="line"></span><br><span class="line">13963 interned Strings occupying 1337040 bytes.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成堆转存快照,要用jhat进行分析</span></span><br><span class="line">[hage@hadoop100 ~]$ jmap -dump:format=b,file=namenode.bin 2882</span><br><span class="line">Dumping heap to /home/hage/namenode.bin ...</span><br><span class="line">Heap dump file created</span><br><span class="line">[hage@hadoop100 ~]$ ls</span><br><span class="line">calllog  logs  myredis  namenode.bin  zookeeper.out</span><br></pre></td></tr></table></figure>

<h4 id="jhat-虚拟机堆转存快照分析工具"><a href="#jhat-虚拟机堆转存快照分析工具" class="headerlink" title="jhat: 虚拟机堆转存快照分析工具"></a>jhat: 虚拟机堆转存快照分析工具</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[hage@hadoop100 ~]$ ls</span><br><span class="line">calllog  logs  myredis  namenode.bin  zookeeper.out</span><br><span class="line">[hage@hadoop100 ~]$ jhat namenode.bin </span><br><span class="line">Reading from namenode.bin...</span><br><span class="line">Dump file created Sat Nov 16 16:28:30 CST 2019</span><br><span class="line">Snapshot read, resolving...</span><br><span class="line">Resolving 393179 objects...</span><br><span class="line">Chasing references, expect 78 dots..............................................................................</span><br><span class="line">Eliminating duplicate references..............................................................................</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port 7000</span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure>

<h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><h3 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h3><img src="F:/我的坚果云/images/java内存模型.jpg" alt="jmm" style="zoom:80%;">

<p><strong>主内存：</strong>可以看做是java堆中的对象实例数据部分</p>
<p><strong>线程的工作内存</strong>：可以对应于虚拟机栈中的部分区域</p>
<p>若线程间要进行通信需要执行：</p>
<p>1.<code>线程A把本地内存中的共享变量写回主内存</code></p>
<p>2.<code>线程B从主内存中读取共享变量到线程B的本地内存中</code></p>
<img src="F:/我的坚果云/images/线程之间的通信.jpg" alt="线程通信" style="zoom:80%;">



<h3 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h3><p>Thread类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>创建线程的三种方式</p>
<p>1.继承Thread类，重写run()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SellTicket</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tickets = <span class="number">100</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span> (tickets&lt;<span class="number">0</span>)&#123;</span><br><span class="line">               System.out.println(<span class="string">"票已卖完"</span>);</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           System.out.println(Thread.currentThread().getName()+<span class="string">"------"</span>+<span class="string">"所剩票数为"</span>+(--tickets));</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line">SellTicket sellTicket = <span class="keyword">new</span> SellTicket();</span><br><span class="line">sellTicket.start();</span><br></pre></td></tr></table></figure>

<p>2.实现Runnable接口，重写run()方法，依此实例作为Thread的target来创建Thread对象 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SellTicket2</span> <span class="keyword">implements</span>  <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tickets = <span class="number">100</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (tickets&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">"票已卖完"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">"------"</span>+<span class="string">"所剩票数为"</span>+(--tickets));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line">SellTicket2 st = <span class="keyword">new</span> SellTicket2();</span><br><span class="line"><span class="keyword">new</span> Thread(st).start();</span><br></pre></td></tr></table></figure>

<p>3.创建Callable接口的实现类，并实现call()方法 ， 使用FutureTask类来包装Callable对象 ， 使用FutureTask对象作为Thread对象的target创建并启动新线程 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><h4 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a><strong>synchronized</strong></h4><ol>
<li><p><strong>synchronized的三种应用方式</strong> </p>
<ul>
<li>对于普通方法，锁的是当前实例对象(<code>实例对象在堆中</code>)</li>
<li>对于静态方法，锁的是当前类对象(<code>类对象存储在方法区中</code>)</li>
<li>对于同步方法块，锁的是synchronized括号里配置的对象</li>
</ul>
</li>
<li><p>synchronized的实现</p>
<ol>
<li><p>synchronized的实现</p>
<p>synchronized运用的方法有两种：</p>
</li>
</ol>
<ul>
<li><p>一种是对方法上锁。访问修饰符ACC_SYNCHRONIZED</p>
</li>
<li><p>一种是构造同步代码块。同步代码块上锁是通过monitorenter,monitorexit指令实现</p>
</li>
</ul>
<p>同步块</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (Test.class)&#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 反汇编代码，通过javap命令可以查看</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">    Code:</span><br><span class="line">       0: ldc           #2                  // class com/hage/Annotation/Test</span><br><span class="line">       <span class="number">2</span>: dup</span><br><span class="line">       <span class="number">3</span>: astore_1</span><br><span class="line">       <span class="comment">// 进入监视器</span></span><br><span class="line">       <span class="number">4</span>: monitorenter  </span><br><span class="line">       5: getstatic     #3                  // Field i:I</span><br><span class="line">       <span class="number">8</span>: iconst_1</span><br><span class="line">       <span class="number">9</span>: iadd</span><br><span class="line">      10: putstatic     #3                  // Field i:I</span><br><span class="line">      <span class="number">13</span>: aload_1</span><br><span class="line">       <span class="comment">// 退出监视器</span></span><br><span class="line">      <span class="number">14</span>: monitorexit</span><br><span class="line">      <span class="number">15</span>: goto          <span class="number">23</span></span><br><span class="line">      <span class="number">18</span>: astore_2</span><br><span class="line">      <span class="number">19</span>: aload_1</span><br><span class="line">      <span class="number">20</span>: monitorexit</span><br><span class="line">      <span class="number">21</span>: aload_2</span><br><span class="line">      <span class="number">22</span>: athrow</span><br><span class="line">      <span class="number">23</span>: <span class="keyword">return</span></span><br><span class="line">    Exception table:</span><br><span class="line">       from    to  target type</span><br><span class="line">           <span class="number">5</span>    <span class="number">15</span>    <span class="number">18</span>   any</span><br><span class="line">          <span class="number">18</span>    <span class="number">21</span>    <span class="number">18</span>   any</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    Code:</span><br><span class="line">       <span class="number">0</span>: iconst_0</span><br><span class="line">       1: putstatic     #3                  // Field i:I</span><br><span class="line">       <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同步方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span>  <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">            i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 反汇编代码，通过javap命令可以查看</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_SYNCHRONIZED <span class="comment">//访问修饰符设为ACC_SYNCHRONIZED</span></span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         0: getstatic     #2                  // Field i:I</span><br><span class="line">         <span class="number">3</span>: iconst_1</span><br><span class="line">         <span class="number">4</span>: iadd</span><br><span class="line">         5: putstatic     #2                  // Field i:I</span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">11</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">8</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">0</span>, args_size=<span class="number">0</span></span><br><span class="line">         <span class="number">0</span>: iconst_0</span><br><span class="line">         1: putstatic     #2                  // Field i:I</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">9</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>锁的底层原理</p>
<p>​     synchronized的实现原理是通过不同对象的加锁实现的，任何一个对象都拥有自己的监视器，当这个对象由同步块或者这个对象的同步方法调用时，执行方法的线程必须先获取到该对象的监视器才能进入同步块或者同步方法</p>
<ol>
<li>java对象头</li>
</ol>
<table>
<thead>
<tr>
<th>长度</th>
<th>内容</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>32bit/64bit</td>
<td>Mark Word</td>
<td>存储对象的hashCode或锁信息</td>
</tr>
<tr>
<td>32bit/64bit</td>
<td>Class Metadata Address</td>
<td>存储到对象类型数据的指针</td>
</tr>
<tr>
<td>32bit/64bit</td>
<td>Array length</td>
<td>数组的长度（若当前对象是数组）</td>
</tr>
</tbody></table>
<p>Mark Word的存储结构</p>
<p><img src="images/image-20191110163554353-1573375177959.png" alt="Markword"></p>
</li>
</ol>
</li>
</ol>
<h4 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a><strong>volatile</strong></h4><ol>
<li>特性</li>
</ol>
<p>​    只能保证可见性，不能保证原子性</p>
<p>​    禁止指令的重排序</p>
<ol start="2">
<li><p>实现原理</p>
<p>volatile 修饰的共享变量进行写操作时会在会增加一条lock指令</p>
<ul>
<li><p>Lock前缀指令会引起处理器缓存写回到内存</p>
</li>
<li><p>一个处理器的缓存回写到内存会导致其他处理器的缓存无效</p>
<p>处理器使用嗅探技术保证它的内部缓存、系统内存和其他处理器的缓存的数据在总线上保持一致</p>
</li>
</ul>
</li>
</ol>
<h4 id="锁的优化（分类）"><a href="#锁的优化（分类）" class="headerlink" title="锁的优化（分类）"></a>锁的优化（分类）</h4><p><code>锁一共有4种状态：无锁状态》偏向锁》轻量级锁》重量级锁</code></p>
<ol>
<li><p>偏向锁：让锁对象的对象头记录线程id</p>
<p>大多数时候，锁总是由同一个线程获得，为了让线程获取锁的代价更低，引入了偏向锁。</p>
<ul>
<li>获取锁的时候，将<strong>线程的栈帧</strong>和<strong>被锁的对象头Mark Word</strong>中存储偏向的线程id</li>
<li>再次进入的时候，<strong>比较锁对象头中的Mark Word是否执行当前线程</strong>，若是，则直接进入</li>
<li>若不是，则尝试CAS将对象头的偏向锁指向当前对象</li>
</ul>
</li>
<li><p>轻量级锁：让锁对象记录Displaced Mark Word的指针位置</p>
<ul>
<li><p>加锁</p>
<ol>
<li>jvm会在线程的栈帧中创建用于存储锁记录的空间，<code>将锁对象的Mark Word复制到锁记录中</code>，官方称为Displaced Mark Word</li>
<li>线程尝试使用CAS将对象头中的Mark Word指向栈帧中锁记录的指针，<code>若失败，则自旋</code></li>
</ol>
</li>
<li><p>解锁</p>
<ol>
<li>使用原子的CAS操作将Displaced Mark Word替换到对象头，若成功，表示没有竞争发生</li>
<li>若失败，表明有竞争，锁膨胀成重量级锁</li>
</ol>
</li>
</ul>
</li>
<li><p>重量级锁： synchronized</p>
<p>​     加锁的形式，没有自旋操作</p>
</li>
</ol>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/09/30/bash的环境配置文件/" rel="next" title="bash的环境配置文件">
                  <i class="fa fa-chevron-left"></i> bash的环境配置文件
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#java面试"><span class="nav-number">1.</span> <span class="nav-text">java面试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#java基础"><span class="nav-number">1.1.</span> <span class="nav-text">java基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#集合有哪些"><span class="nav-number">1.1.1.</span> <span class="nav-text">集合有哪些</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#String-StringBuilder-StringBuffer的区别"><span class="nav-number">1.1.2.</span> <span class="nav-text">String,StringBuilder,StringBuffer的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现多态的方式？"><span class="nav-number">1.1.3.</span> <span class="nav-text">实现多态的方式？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重载（Overload）和重写（Override）的区别？"><span class="nav-number">1.1.4.</span> <span class="nav-text">重载（Overload）和重写（Override）的区别？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#深拷贝和浅拷贝的区别"><span class="nav-number">1.1.5.</span> <span class="nav-text">深拷贝和浅拷贝的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NIO和BIO"><span class="nav-number">1.1.6.</span> <span class="nav-text">NIO和BIO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#反射"><span class="nav-number">1.1.7.</span> <span class="nav-text">反射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注解"><span class="nav-number">1.1.8.</span> <span class="nav-text">注解</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JVM"><span class="nav-number">1.2.</span> <span class="nav-text">JVM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内存区域"><span class="nav-number">1.2.1.</span> <span class="nav-text">内存区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#垃圾回收"><span class="nav-number">1.2.2.</span> <span class="nav-text">垃圾回收</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#对象存活性判断"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">对象存活性判断</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#无用的类"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">无用的类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#垃圾收集算法"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">垃圾收集算法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HotSpot算法实现"><span class="nav-number">1.2.2.4.</span> <span class="nav-text">HotSpot算法实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java当中的四种引用"><span class="nav-number">1.2.3.</span> <span class="nav-text">java当中的四种引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#类加载机制"><span class="nav-number">1.2.4.</span> <span class="nav-text">类加载机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#类加载的时机："><span class="nav-number">1.2.4.1.</span> <span class="nav-text">类加载的时机：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类加载器"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">类加载器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义类加载器"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">自定义类加载器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#类加载的过程："><span class="nav-number">1.2.4.4.</span> <span class="nav-text">类加载的过程：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟机性能监控工具"><span class="nav-number">1.2.5.</span> <span class="nav-text">虚拟机性能监控工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#jps-虚拟机进程状况工具"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">jps:虚拟机进程状况工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jstat-虚拟机统计信息监视工具"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">jstat:虚拟机统计信息监视工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jinfo-Java配置信息工具"><span class="nav-number">1.2.5.3.</span> <span class="nav-text">jinfo:Java配置信息工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jmap-java内存映像工具"><span class="nav-number">1.2.5.4.</span> <span class="nav-text">jmap: java内存映像工具</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#jhat-虚拟机堆转存快照分析工具"><span class="nav-number">1.2.5.5.</span> <span class="nav-text">jhat: 虚拟机堆转存快照分析工具</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#并发"><span class="nav-number">1.3.</span> <span class="nav-text">并发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内存模型"><span class="nav-number">1.3.1.</span> <span class="nav-text">内存模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#线程"><span class="nav-number">1.3.2.</span> <span class="nav-text">线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#锁"><span class="nav-number">1.3.3.</span> <span class="nav-text">锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#synchronized"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">synchronized</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#volatile"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">volatile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#锁的优化（分类）"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">锁的优化（分类）</span></a></li></ol></li></ol></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/hage.png"
      alt="hage">
  <p class="site-author-name" itemprop="name">hage</p>
  <div class="site-description" itemprop="description">每天写一点</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/hage1527" title="GitHub &rarr; https://github.com/hage1527"><i class="fa fa-fw fa-globe"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="/2545772885@qq.com" title="E-Mail &rarr; 2545772885@qq.com"><i class="fa fa-fw fa-globe"></i>E-Mail</a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hage</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.0</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
